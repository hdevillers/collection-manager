{% extends "plasmid/base.html.twig" %}

{% block title %}Plasmid{% endblock %}

{% block breadcrumb %}
    {{ parent() }}
    <li><a href="{{ path('plasmid_index') }}">Plasmids list</a></li>
    <li class="active">Add a plasmid</li>
{% endblock %}

{% block plasmid_body %}
    <h2 class="sub-header">Add a plasmid</h2>

    {{ include('plasmid/form.html.twig') }}
{% endblock %}

{% block javascripts %}
    {{ parent() }}

    <script>
        $( function() {
            charMap($('#plasmid_name'));
            collectionType($('div#plasmid_primers'), 'Add a primer', 'add-primer');

            $('[id^="plasmid_primers_"]').select2();
            $('#add-primer').click(function() {
                $('[id^="plasmid_primers_"]').select2();
            });

            var $team = $('[name$="[team]"]');
            // When genus gets selected ...
            $team.change(function () {
                // ... retrieve the corresponding form.
                var $form = $(this).closest('form');
                // Simulate form data, but only include the selected genus value.
                var data = {};
                data[$team.attr('name')] = $team.val();

                // Submit data via AJAX to the form's action path.
                $.ajax({
                    url: $form.attr('action'),
                    type: $form.attr('method'),
                    data: data,
                    success: function (html) {
                        // Replace current position field ...
                        $('div#plasmid_primers').replaceWith(
                            // ... with the returned one from the AJAX response.
                            $(html).find('#plasmid_primers')
                        );
                        collectionType($('div#plasmid_primers'), 'Add a primer', 'add-primer');
                        $('#add-primer').click(function() {
                            $('[id^="plasmid_primers_"]').select2();
                        });
                    }
                });
            });
        } );
    </script>
{% endblock %}
