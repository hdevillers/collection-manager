{% extends "box/base.html.twig" %}

{% block title %}Box: {{ box.name }}{% endblock %}

{% block breadcrumb %}
    {{ parent() }}
    <li><a href="{{ path('box_index') }}">Boxes list</a></li>
    <li class="active">{{ box.autoName }} ({{ box.name }})</li>
{% endblock %}

{% block box_body %}

    <div class="row">
        <div class="col-md-10">
            <h2 class="sub-header">Box: {{ box.autoName }} ({{ box.name }})</h2>

        </div>

        <div class="col-md-2">
            {% embed "box/_delete_form.html.twig" with { box: box } only %}
                {% block btn %}
                    {% if is_granted('BOX_EDIT', box) %}
                        <a class="btn btn-warning" href="{{ path('box_edit', { 'id': box.id}) }}">
                            <span class="glyphicon glyphicon-edit" aria-hidden="true"></span> Edit
                        </a>
                    {% endif %}
                {% endblock %}
            {% endembed %}
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            <div class="panel panel-default">
                <!-- Default panel contents -->
                <div class="panel-heading">Informations</div>
                <div class="panel-body">
                    <p>{{ box.description }}</p>
                </div>

                <!-- List group -->
                <ul class="list-group">
                    <li class="list-group-item">Projet: {{ box.project.name }}</li>
                    <li class="list-group-item">Congélateur: {{ box.freezer }}</li>
                    <li class="list-group-item">Emplacement dans le congélateur: {{ box.location }}</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-5">
            {% set letters = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'] %}
            {% set cellWidth, cellHeight = 50, 50 %}
            {% set width = cellWidth * (box.colNumber + 1) %}

            <table class="table table-bordered table-boxes-mapping" width="{{ width }}">
                {% set cellCounter = 0 %}
                {% for r in 0..box.rowNumber %}
                    <tr>
                        {% for c in 0..box.colNumber %}
                            {% if r != 0 %}
                                {% if c != 0 %}
                                    {% if tubes[cellCounter] is defined %}
                                        <td
                                            style="background-color: {{ tubes[cellCounter].deleted ? 'darkgrey' : 'greenyellow' }};"
                                            data-toggle="popover" data-placement="top" data-trigger="hover" data-container="body"
                                            title="{{ tubes[cellCounter].strain.autoName }}"
                                            data-content="{{ tubes[cellCounter].strain.name }}">
                                            {{ cellCounter + 1 }}
                                        </td>
                                    {% else %}
                                        <td>
                                            {{ cellCounter + 1 }}
                                        </td>
                                    {% endif %}

                                    {% set cellCounter = cellCounter + 1 %}
                                {% else %}
                                    {% if r != 0 %}
                                        <th class="text-center" height="{{ cellHeight }}" width="{{ cellWidth }}">{{ letters[r-1] }}</th>
                                    {% endif %}
                                {% endif %}
                            {% else %}
                                {% if c != 0 %}
                                    <th class="text-center" height="{{ cellHeight }}" width="{{ cellWidth }}">{{ c }}</th>
                                {% else %}
                                    <th></th>
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                    </tr>
                {% endfor %}
            </table>
        </div>

        <div class="col-md-7">
            <div class="panel panel-default">
                <!-- Default panel contents -->
                <div class="panel-heading">Strain list</div>
                <table class="table table-striped">
                    <tr>
                        <th>Cell</th>
                        <th>Auto Name</th>
                        <th>Name</th>
                        <th>Project</th>
                    </tr>

                    {% for tube in box.tubes %}
                        <tr>
                            <td>{{ tube.cellName }}</td>
                            <td>
                                <a href="{{ path('strain_view', { 'id': tube.strain.id, 'slug': tube.strain.slug }) }}">{{ tube.strain.autoName }}</a>
                            </td>
                            <td>{{ tube.strain.name }}</td>
                            <td>{{ tube.box.project.name }}</td>
                        </tr>
                    {% endfor %}
                </table>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}

    <script>
        $(function () {
            $('[data-toggle="popover"]').popover();
        })
    </script>
{% endblock %}
